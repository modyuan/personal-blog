(this["webpackJsonppersonal-blog-react-app"]=this["webpackJsonppersonal-blog-react-app"]||[]).push([[0],{11:function(e,t,n){e.exports=n(216)},16:function(e,t,n){},17:function(e,t,n){},18:function(e,t,n){},19:function(e,t,n){},20:function(e,t,n){},21:function(e,t,n){},215:function(e,t,n){},216:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(9),i=n.n(r),c=(n(16),n(1)),l=n(2),s=n(4),u=n(3),p=n(10),h=(n(17),function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={username:"",password:""},a}return Object(l.a)(n,[{key:"onSubmit",value:function(e){e.preventDefault(),this.setState({show:!1}),this.props.onSubmit?this.props.onSubmit({username:this.state.username,password:this.state.password}):console.warn("onSubmit is not handled!")}},{key:"onClose",value:function(e){e.preventDefault(),this.props.onClose&&this.props.onClose()}},{key:"onChange",value:function(e){this.setState(Object(p.a)({},e.target.name,e.target.value))}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"PopDialog-back"},o.a.createElement("div",{className:"PopDialog"},o.a.createElement("div",{onClick:function(t){e.onClose(t)},style:{position:"absolute",right:"12px",top:"12px",width:20,height:20,cursor:"pointer"}},o.a.createElement("svg",{t:"1587447439035",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1141",width:"20",height:"20"},o.a.createElement("path",{d:"M810.666667 273.493333L750.506667 213.333333 512 451.84 273.493333 213.333333 213.333333 273.493333 451.84 512 213.333333 750.506667 273.493333 810.666667 512 572.16 750.506667 810.666667 810.666667 750.506667 572.16 512z","p-id":"1142",fill:"#000000"}))),o.a.createElement("form",{onSubmit:function(t){return e.onSubmit(t)}},o.a.createElement("label",{style:{display:"block"}}," \u8bf7\u767b\u5f55 "),o.a.createElement("input",{type:"text",name:"username",placeholder:"\u8bf7\u8f93\u5165\u7528\u6237\u540d",value:this.state.username||"",onChange:function(t){return e.onChange(t)}}),o.a.createElement("input",{type:"password",name:"password",placeholder:"\u8bf7\u8f93\u5165\u5bc6\u7801",value:this.state.password||"",onChange:function(t){return e.onChange(t)}}),o.a.createElement("button",null,"\u767b\u5f55"))))}}]),n}(o.a.Component)),d=(n(18),function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=null;return e=this.props.userName?[o.a.createElement("li",{key:"username"},"\u4f60\u597d\uff0c",this.props.userName),o.a.createElement("li",{key:"logoff",onClick:this.props.onRequireLogoff},"\u6ce8\u9500")]:[o.a.createElement("li",{key:"pleaseLogin",onClick:this.props.onRequireLogin},"\u8bf7\u767b\u5f55")],o.a.createElement("div",null,o.a.createElement("div",{className:"AppNav-wrap"},o.a.createElement("div",{className:"AppNav"},o.a.createElement("ul",null,o.a.createElement(m,{href:"/"},"\u9996\u9875"),o.a.createElement(m,{href:"/about"},"\u5173\u4e8e")),o.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},e))),o.a.createElement("div",{className:"AppNav-place"}))}}]),n}(o.a.Component)),m=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).onClick=function(t){t.preventDefault(),window.history.pushState(null,"",e.props.href),window.onpopstate&&window.onpopstate()},e}return Object(l.a)(n,[{key:"render",value:function(){return o.a.createElement("li",null,o.a.createElement("a",{style:{textDecorationLine:"none",color:"inherit"},href:this.props.href,onClick:this.onClick},this.props.children))}}]),n}(o.a.Component),f=d;n(19),n(8);function g(e){return o.a.createElement("div",{className:"TextListItem Card",onClick:e.onClick},o.a.createElement("h1",{style:{cursor:"pointer"}},e.title),o.a.createElement("div",{name:"brief"},e.brief),o.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},o.a.createElement("div",null,e.author," \u53d1\u5e03\u4e8e ",e.date.toLocaleString())))}var v=function(e){console.log("render TextList!");var t=null;return console.log("TextList data: "+JSON.stringify(e.data)),e.data&&(t=e.data.map((function(t){return o.a.createElement(g,{title:t.title,brief:t.brief,author:t.author,date:t.date,id:t.id,key:t.id,onClick:function(){return e.onClick(t.id)}})}))),o.a.createElement("div",{style:{width:1e3,margin:"0 auto"}},t)},x=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return o.a.createElement("div",null," \u5173\u4e8e\u9875\u9762 ")}}]),n}(o.a.Component),w=(n(20),n(21),n(5)),y=n.n(w),k=n(6),E=n.n(k),b=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){return Object(c.a)(this,n),t.call(this,e)}return Object(l.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){window.MathJax.typeset()}},{key:"render",value:function(){if(!this.props.data)return o.a.createElement("div",{style:{width:1e3,margin:"0 auto"}});var e=new y.a.Converter({extensions:[E.a]});e.setFlavor("github");var t=e.makeHtml(this.props.data.content),n=null;return this.props.data.login&&(n=o.a.createElement("button",{style:{margin:10,borderRadius:3,background:"skyblue",border:"1px solid blue"}},"\u4fee\u6539")),o.a.createElement("div",{style:{width:1e3,margin:"0 auto"}},o.a.createElement("div",{className:"Card"},o.a.createElement("h1",{style:{margin:"0",textAlign:"center"}},this.props.data.title),o.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",fontSize:10,color:"#aaa"}},n,o.a.createElement("div",null,this.props.data.author," \u521b\u5efa\u4e8e ",this.props.data.createTime.Format("yyyy-MM-dd HH:mm:ss")))),o.a.createElement("div",{className:"Card markdown",style:{padding:"20px 40px"},dangerouslySetInnerHTML:{__html:t}}))}}]),n}(o.a.Component),C=(n(215),function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).onClick=function(e){e>0?(a.setState({cur:parseInt(e)}),a.props.onClick&&a.props.onClick(e)):-2===e?a.setState((function(e,t){var n=e.cur;if(n+1<=t.maxPage)return t.onClick&&t.onClick(n+1),{cur:n+1}})):a.setState((function(e,t){var n=e.cur;if(n-1>=1)return t.onClick&&t.onClick(n-1),{cur:n-1}}))},a.state={cur:parseInt(a.props.cur)||1},a}return Object(l.a)(n,[{key:"render",value:function(){for(var e=this,t=parseInt(this.props.maxPage),n=[],a=1;a<=t;a++)n.push(a);var r=n.map((function(t){return o.a.createElement("li",{className:"".concat(e.state.cur===t?"PageSelectorCur":null),onClick:function(){e.onClick(t)},key:t},t)}));return o.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},o.a.createElement("div",{className:"PageSelector"},o.a.createElement("ul",null,o.a.createElement("li",{onClick:function(){e.onClick(-1)}},"<"),r,o.a.createElement("li",{onClick:function(){e.onClick(-2)}},">"))))}}]),n}(o.a.Component)),S=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).checkMaxPageIndex=function(){fetch("/api/articleCount").then((function(e){return e.json()})).then((function(e){var t=parseInt(e);t>0&&a.setState({maxPageIndex:Math.ceil(t/10)})}))},a.checkLoginStatus=function(){fetch("/user/login",{credentials:"include"}).then((function(e){if(200===e.status)return e.json();a.setState({userName:null})})).then((function(e){e&&a.setState({userName:e.username})})).catch((function(e){console.error("fail to parse json from /user/login")}))},a.onRequireLogin=function(){a.setState({showLoginDialog:!0})},a.onRequireLogoff=function(){fetch("/user/logout",{method:"post",credentials:"same-origin"}).then((function(e){a.setState({userName:null})})).catch((function(e){console.error("fail to post /user/logout!")}))},a.onLogin=function(e){fetch("/user/login",{method:"post",credentials:"same-origin",headers:{"Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify(e)}).then((function(t){200===t.status?a.setState({userName:e.username,showLoginDialog:!1}):(a.setState({userName:null}),alert("\u767b\u5f55\u5931\u8d25\uff01"))})).catch((function(e){console.error("fail to access /user/login!")}))},a.onLoginClose=function(){a.setState({showLoginDialog:!1})},a.loadTextList=function(e,t){fetch("/api/articles?pageIndex=".concat(e,"&pageSize=").concat(10)).then((function(e){return e.json()})).then((function(n){var o=n.map((function(e){return{id:e.id,title:e.title,author:e.author,brief:e.brief,date:new Date(e.createTime),tags:e.tags}}));t&&t(),a.setState({currentTextList:o,pageIndex:e})})).catch((function(e){console.error("fail to parse json from /articles")}))},a.onClickPageSelector=function(e){a.loadTextList(e,(function(){a.switchPage("/list/"+e,!0,!1)}))},a.loadText=function(e,t){fetch("/api/article/".concat(e)).then((function(e){return e.json()})).then((function(e){t&&t(),e.createTime=new Date(e.createTime),a.setState({currentText:e})})).catch((function(e){console.log(e)}))},a.onClickTextListItem=function(e){a.loadText(e,(function(){a.switchPage("/text/"+e,!0,!1)}))},a.state={userName:null,showLoginDialog:!1,pageIndex:1,maxPageIndex:1,currentText:null,currentTextList:[]},window.location.pathname.match("^/list/\\d+")&&(a.state.pageIndex=parseInt(window.location.pathname.slice(6))),a.checkLoginStatus(),a.checkMaxPageIndex(),a}return Object(l.a)(n,[{key:"switchPage",value:function(e,t,n){console.log("onSwitchPage "+e),t&&window.history.pushState(null,"",e),n&&this.forceUpdate()}},{key:"componentDidMount",value:function(){var e=this;window.onpopstate=function(){e.forceUpdate()}}},{key:"componentWillUnmount",value:function(){window.onpopstate=null}},{key:"render",value:function(){var e=this;console.log("<App> render!");var t=[["^/$",function(){return console.log("route: index!"),0!==e.state.currentTextList.length&&1===e.state.pageIndex||e.loadTextList(1),o.a.createElement("div",null,o.a.createElement(v,{data:e.state.currentTextList,onClick:e.onClickTextListItem}),o.a.createElement(C,{maxPage:e.state.maxPageIndex,onClick:e.onClickPageSelector}))}],["^/about$",function(){return o.a.createElement(x,null)}],["^/text/\\d+$",function(t){console.log("route: text/id");var n=parseInt(t.slice(6));return e.state.currentText||(console.log("current Text\u4e0d\u5b58\u5728\uff0c \u5c1d\u8bd5\u8f7d\u5165\u3002\u3002\u3002"),e.loadText(n)),o.a.createElement(b,{data:e.state.currentText,login:null!==e.state.userName,onModify:e.onTextWantModify})}],["^/login$",function(){return setTimeout((function(){e.setState({showLoginDialog:!0}),window.history.pushState(null,"","/"),window.onpopstate()}),100),null}],["^/list/\\d+$",function(t){console.log("route: list/index");var n=parseInt(t.slice(6))||1;return 0!==e.state.currentTextList.length&&e.state.pageIndex===n||(console.log("\u76d1\u6d4b\u5230path(".concat(n,")\u548c\u5f53\u524d\u9875\u6570\u4e0d\u4e00\u81f4\uff08").concat(e.state.pageIndex,"\uff09 \u8f7d\u5165\u5217\u8868")),e.loadTextList(n)),o.a.createElement("div",null,o.a.createElement(v,{data:e.state.currentTextList,onClick:e.onClickTextListItem}),o.a.createElement(C,{maxPage:e.state.maxPageIndex,onClick:e.onClickPageSelector,cur:e.state.pageIndex}))}]],n=null;return t.find((function(e){if(window.location.pathname.match(e[0])){var t=e[1](window.location.pathname);return n=t,!0}return!1}))||(console.log("fall back to index"),n=t[0][1](window.location.pathname)),o.a.createElement("div",null,o.a.createElement(f,{userName:this.state.userName,onRequireLogin:this.onRequireLogin,onRequireLogoff:this.onRequireLogoff}),n,this.state.showLoginDialog&&o.a.createElement(h,{onSubmit:this.onLogin,onClose:this.onLoginClose}),o.a.createElement("div",{style:{height:40}}," "))}}]),n}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e},i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(S,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},8:function(e,t,n){}},[[11,1,2]]]);
//# sourceMappingURL=main.54fa4a8e.chunk.js.map